#!/usr/bin/perl
use v5.14.1;

BEGIN {
    use Cwd 'abs_path';
    my $dir = abs_path($0);
    $dir =~ s{[^/]+$}{..};

    unless( -d "$dir/lib" and -d "$dir/dir/lib/perl5" ) { 
        if ( -d "/srv/gndaccess/lib" and -d "/srv/gndaccess/dir/lib/perl5" ) {
            $dir = "/srv/gndaccess";
        }
    }
    
    unshift @INC, "$dir/lib", "$dir/dir/lib/perl5";
}    

use GBV::App::GNDMARConvert::Mapping;
use JSON;

# Carton is installed, so we could also use its dependencies...
# TODO: get input and output formats

if (@ARGV) {
    transform($_) for @ARGV;
} else {
    transform(\*STDIN);
}

sub transform {
    my $json = marc_file_to_json(shift);
    say JSON->new->utf8->pretty->encode($json);
}
